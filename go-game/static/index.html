<head>
    <link href="simple.css" type="text/css" rel="stylesheet" />
</head>
<body>
    <div id="other-cards-header"><h3>Other Cards</h3>
	<div id="other-cards"></div>
    </div>
    <div id="last-play-header"><h3>Last Play</h3>
	<div id="last-cards"></div>
    </div>
    <div id="my-cards-header"><h3>My Cards</h3>
	<div id="my-cards"></div>
    </div>
    <form id="send-cards" class="form-inline">
	<div class="form-group">
	    <input id="input-card" type="text" class="form-control" placeholder="Card" autofocus />
	</div>
	<div class="form-group">
	    <input id="input-num-cards" type="text" class="form-control" placeholder="# of cards" autofocus />
	</div>
	<button class="btn btn-primary" type="submit">Send</button>
    </form>

    <div id="log"></div>

    <script src="jquery-2.1.3.js"></script>
    <script type="text/javascript">
     function getSortedKeys(obj) {
	 // TODO: sort by integer value and not string value.
	 keys = Object.keys(obj)
	 return keys.sort();
     }

     function makeCardString(cardObj) {
	 keys = getSortedKeys(cardObj);
	 var cards = ""
	 for (var k in keys) {
	     cards += (k + ":" + cardObj[k] + " ")
	 }
	 return cards;
     }

     function WebSocketTest() {
	 if ("WebSocket" in window) {
	     $('<p>Websocket connection opened</p>').appendTo('#log');
	     // Let us open a web socket
	     var ws = new WebSocket("ws://localhost:9999/echo");
	     ws.onmessage = function (evt) { 
		 var received_msg = evt.data;
		 var received_obj = JSON.parse(received_msg);
		 console.debug("%o", received_obj);
		 switch(received_obj.Message) {
			 case "player_cards":
			 console.log("Got player_cards");
			 document.getElementById("my-cards").innerHTML = "";
			 var cards = makeCardString(received_obj.Cards);
			 $('<p>' + cards + '</p>').appendTo('#my-cards');
			 break;
			 case "start_game":
			 console.log("Got start_game");
			 break;
			 default:
			 console.log("Unknown message type");
			 $('<p>' + received_msg + '</p>').appendTo('#log');
		 }
	     };
	     ws.onclose = function() { 
		 $('<p>Websocket connection closed</p>').appendTo('#log');
	     };

	     <!-- Send a websockets message on click -->
	     $(function () {
		 $('#Add').on('click', function () {
		     ws.send("Message body");
		 });
	     });

	     <!-- Make the form work -->
	     $("#send-cards").on("submit", function(event) {
		 event.preventDefault();
		 var card = $("#input-card")[0].value;
		 var num_cards   = Number($("#input-num-cards")[0].value);
		 var play = {};
		 var bogus_player = 0;
		 play[card] = num_cards;
		 ws.send(JSON.stringify({ Message : "play_card", Player : bogus_player, Cards : play }));
		 $("#input-text")[0].value = "";
	     });   
	 } else {
	     // The browser doesn't support WebSocket
	     alert("WebSocket NOT supported by your Browser!");
	 }
     }
     WebSocketTest();
     
    </script>
</body>
